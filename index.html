<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ðŸš€ Futuristic Inventory Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0f1c;
      --glass: rgba(255,255,255,0.05);
      --accent: #00ffe7;
      --danger: #ff4d6d;
      --ok: #34d399;
      --muted: #9ca3af;
      --radius: 18px;
      --shadow: 0 8px 30px rgba(0,0,0,0.6);
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      background: var(--bg);
      color: #fff;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: var(--glass);
      backdrop-filter: blur(20px);
      padding: 20px;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow);
      border-right: 1px solid rgba(255,255,255,0.1);
    }
    .sidebar h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 22px;
      color: var(--accent);
      margin-bottom: 30px;
      text-align: center;
    }
    .nav-item {
      padding: 14px 16px;
      margin-bottom: 10px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.25s ease;
      text-align: center;
    }
    .nav-item:hover { background: rgba(255,255,255,0.1); }
    .nav-item.active { background: var(--accent); color: #000; font-weight: bold; }

    /* Main content */
    .main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      background: linear-gradient(135deg, #0a0f1c 0%, #10172a 100%);
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .card {
      background: var(--glass);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(20px);
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 20px;
      color: var(--accent);
      margin-top: 0;
    }

    label { display: block; margin-top: 14px; color: var(--muted); font-size: 14px; }

    input, select, button {
      width: 100%;
      padding: 12px 14px;
      margin-top: 6px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.07);
      color: #fff;
      font-size: 15px;
      transition: border-color 0.2s ease;
    }
    input:focus, select:focus { outline: none; border-color: var(--accent); }

    button {
      background: var(--accent);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    button:hover { transform: scale(1.03); opacity: 0.9; }

    /* Status colors */
    .status-approved { color: var(--ok); font-weight: bold; }
    .status-rejected { color: var(--danger); font-weight: bold; }
    .status-pending { color: var(--accent); font-weight: bold; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h1>INVENTORY</h1>
    <div class="nav-item active" data-tab="items">ðŸ“¦ Items</div>
    <div class="nav-item" data-tab="inflow">â¬† Inflow</div>
    <div class="nav-item" data-tab="outflow">â¬‡ Outflow</div>
    <div class="nav-item admin-only" data-tab="requests" style="display:none;">âš¡ Requests</div>
    <div style="margin-top:auto;">
      <p id="who" style="font-size:14px;color:var(--muted);">Not signed</p>
      <input id="loginUser" placeholder="username">
      <input id="loginPass" type="password" placeholder="password">
      <button id="btnLogin">Login</button>
      <button id="btnLogout" style="display:none;">Logout</button>
    </div>
  </div>

  <div class="main">
    <div id="tab-items" class="dash-tab">
      <div class="card">
        <h2>Manage Items</h2>
        <div style="display:flex;gap:10px;margin-top:12px">
          <input id="newItem" placeholder="New item name">
          <button id="btnAddItem">+ Add</button>
        </div>
        <p id="addItemMsg" style="margin-top:8px;font-size:14px;color:var(--muted)"></p>
      </div>
    </div>

    <div id="tab-inflow" class="dash-tab" style="display:none;">
      <div class="card">
        <h2>Inflow Request</h2>
        <label>Date</label><input id="inRequestDate" type="date">
        <div id="inRows" style="margin-top:10px"></div>
        <button id="btnAddInRow">+ Add Item Row</button>
        <button id="btnSubmitIn">Submit Request</button>
        <p id="inMsg" style="margin-top:8px;font-size:14px;color:var(--muted)"></p>
      </div>
    </div>

    <div id="tab-outflow" class="dash-tab" style="display:none;">
      <div class="card">
        <h2>Outflow Request</h2>
        <label>Date</label><input id="outRequestDate" type="date">
        <label>Item</label><select id="outItem"></select>
        <label>Total Quantity</label><input id="outTotal" type="number" min="1">
        <h3 style="margin-top:14px;color:var(--accent)">Receivers</h3>
        <div id="receivers"></div>
        <button id="btnAddReceiver">+ Add Receiver</button>
        <button id="btnSubmitOut">Submit Request</button>
        <p id="outMsg" style="margin-top:8px;font-size:14px;color:var(--muted)"></p>
      </div>
    </div>

    <div id="tab-requests" class="dash-tab" style="display:none;">
      <div class="card">
        <h2>Requests Dashboard</h2>
        <div style="margin-top:12px">
          <input id="filterItem" placeholder="Filter by item">
          <input id="filterUser" placeholder="Filter by user">
          <button id="btnApplyFilters">Apply Filters</button>
        </div>
        <div id="requestsArea" style="margin-top:16px"></div>
      </div>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyw6Z-nWuwli4iqGW1Eh-0RknkB0ND7qns2nV7-7ZX1o9KnKoOmHzIiZa81X5JrcZsK/exec"; // Replace with deployed Apps Script URL

function $(id){ return document.getElementById(id); }
function txt(id,s){ if($(id)) $(id).innerText=s; }
function getSession(){ return JSON.parse(localStorage.getItem('session')||'{}'); }
function setSession(s){ localStorage.setItem('session',JSON.stringify(s)); }
function clearSession(){ localStorage.removeItem('session'); }

async function post(data){
  const r = await fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  });
  return r.json();
}

// === Login ===
$("btnLogin").addEventListener("click", async () => {
  const u = $("loginUser").value.trim();
  const p = $("loginPass").value.trim();
  if (!u || !p) return alert("Enter username & password");
  const res = await post({ action:"login", username:u, password:p });
  if(res.success){
    setSession({ user:u, pass:p });
    txt("who","Signed as "+u+(res.isAdmin?" (Admin)":""));
    $("btnLogin").style.display="none";
    $("btnLogout").style.display="block";
    document.querySelectorAll(".admin-only").forEach(el=>el.style.display=res.isAdmin?"block":"none");
  }else{
    alert("Login failed: "+res.error);
  }
});

$("btnLogout").addEventListener("click", () => {
  clearSession();
  txt("who","Not signed");
  $("btnLogin").style.display="block";
  $("btnLogout").style.display="none";
});

// === Items ===
async function loadItems(){
  const r = await fetch(API_URL+"?action=getItems");
  const js = await r.json();
  if(js && js.success){
    $("outItem").innerHTML = "<option value=''>Select</option>" + js.items.map(i=>`<option>${i}</option>`).join("");
    document.querySelectorAll("#inRows select.itemSel").forEach(sel=>{
      const old = sel.value;
      sel.innerHTML = "<option value=''>Select</option>"+js.items.map(i=>`<option>${i}</option>`).join("");
      if(old) sel.value = old;
    });
  }
}

// === Tabs ===
function showDashTab(tab){
  document.querySelectorAll('.dash-tab').forEach(t=>t.style.display='none');
  $("tab-"+tab).style.display="block";
}
document.querySelectorAll('.nav-item').forEach(it=>{
  it.addEventListener('click', ()=>{
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    it.classList.add('active');
    showDashTab(it.dataset.tab);
  });
});

loadItems();
</script>
</body>
</html>

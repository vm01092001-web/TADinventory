<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Material Tracker</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    form { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 10px; }
    input, select { margin: 5px 0; padding: 8px; width: 95%; }
    button { padding: 10px 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Material Tracker</h1>

  <!-- Google Sign-In button -->
<div id="g_id_onload"
     data-client_id="YOUR_GOOGLE_CLIENT_ID"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<div class="g_id_signin"
     data-type="standard"
     data-size="large"
     data-theme="outline"
     data-text="continue_with"
     data-shape="rectangular"
     data-logo_alignment="left"
     data-context="signin"
     data-itp_support="true">
</div>


  <!-- Welcome message -->
  <div id="welcome" class="hidden">
    <p>Welcome, <span id="userEmail"></span></p>
  </div>

  <!-- Inflow form -->
  <form id="inflowForm" class="hidden">
    <h2>Inflow Entry</h2>
    <label>Date:</label>
    <input type="date" id="inflowDate" required>
    <label>Item:</label>
    <select id="inflowItem" required>
      <option value="">Select Item</option>
      <option>Apples</option>
      <option>Bananas</option>
      <option>Cherries</option>
      <option>Jams</option>
      <option>Yams</option>
    </select>
    <label>Quantity:</label>
    <input type="number" id="inflowQty" required>
    <button type="submit">Submit Inflow</button>
  </form>

  <!-- Outflow form -->
  <form id="outflowForm" class="hidden">
    <h2>Outflow Entry</h2>
    <label>Date:</label>
    <input type="date" id="outflowDate" required>
    <label>Item:</label>
    <select id="outflowItem" required>
      <option value="">Select Item</option>
      <option>Apples</option>
      <option>Bananas</option>
      <option>Cherries</option>
      <option>Jams</option>
      <option>Yams</option>
    </select>
    <label>Quantity:</label>
    <input type="number" id="outflowQty" required>
    <label>Recipient:</label>
    <input type="text" id="outflowRecipient" required>
    <button type="submit">Submit Outflow</button>
  </form>

  <script>
    let currentUser = null;
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw18WtPw-q09UWgEJAnIJZvppHyLGNICIgAgnnhC_ROSZ4kaOcVj6GBpaMyUZgU6wfp/exec"; // Replace with Apps Script web app URL

    // Handle Google login
    function handleCredentialResponse(response) {
      const data = parseJwt(response.credential);
      currentUser = data.email;
      document.getElementById("userEmail").textContent = currentUser;
      document.getElementById("welcome").classList.remove("hidden");
      document.getElementById("inflowForm").classList.remove("hidden");
      document.getElementById("outflowForm").classList.remove("hidden");
    }

    // Decode JWT token (from Google login)
    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // Submit inflow form
    document.getElementById("inflowForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const payload = {
        type: "inflow",
        user: currentUser,
        date: document.getElementById("inflowDate").value,
        item: document.getElementById("inflowItem").value,
        quantity: document.getElementById("inflowQty").value,
        recipient: "" // no recipient for inflow
      };
      await sendData(payload);
      alert("Inflow entry submitted!");
      e.target.reset();
    });

    // Submit outflow form
    document.getElementById("outflowForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const payload = {
        type: "outflow",
        user: currentUser,
        date: document.getElementById("outflowDate").value,
        item: document.getElementById("outflowItem").value,
        quantity: document.getElementById("outflowQty").value,
        recipient: document.getElementById("outflowRecipient").value
      };
      await sendData(payload);
      alert("Outflow entry submitted!");
      e.target.reset();
    });

    // Send data to Apps Script
    async function sendData(payload) {
      const res = await fetch(WEB_APP_URL, {
        method: "POST",
        body: JSON.stringify(payload)
      });
      return res.json();
    }
  </script>
</body>
</html>
